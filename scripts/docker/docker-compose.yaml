---
services:
    web:
        image: ${ECR_REPOSITORY_URI}:latest
        restart: always
        healthcheck:
            test: [CMD-SHELL, curl -f http://localhost:80 || exit 1]
            interval: 10s
            timeout: 5s
            retries: 2
            start_period: 5s
        labels:
            - traefik.enable=true
            - traefik.http.routers.nginx.rule=PathPrefix(\`/\`)
            - traefik.http.routers.nginx.entrypoints=web
            - traefik.http.services.nginx.loadbalancer.server.port=80

    traefik:
        image: traefik:v2.4
        command:
            - --providers.docker=true
            - --entrypoints.web.address=:80
        ports:
            - 80:80
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
